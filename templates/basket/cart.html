{# templates/basket/cart.html #}
{% extends "base.html" %}

{% block title %}Корзина{% endblock %}

{% block content %}
<div class="container my-4">
  <h2 class="mb-4">Корзина</h2>

  {% if items %}
    <div class="table-responsive">
      <table class="table align-middle">
        <thead>
          <tr>
            <th style="width: 60%">Товар</th>
            <th class="text-center">Тип</th>
            <th class="text-end">Цена</th>
            <th class="text-center">Кол-во</th>
            <th class="text-end">Сумма</th>
            <th class="text-center"></th>
          </tr>
        </thead>
        <tbody>
          {% for item in items %}
          <tr>
            <td>
              <div class="d-flex align-items-center">
                {% if item.product and item.product.image %}
                  <img src="{{ item.product.image.url }}"
                       alt="{{ item.product }}"
                       class="me-3"
                       style="width:70px;height:70px;object-fit:cover;">
                {% endif %}
                <div>
                  <div class="fw-semibold">
                    {{ item.product|default:"Товар удалён" }}
                  </div>
                  {% if item.product and item.product.article %}
                    <div class="text-muted small">Арт: {{ item.product.article }}</div>
                  {% endif %}
                </div>
              </div>
            </td>

            <td class="text-center">
              {% if item.product_type == "tire" %}Шина{% elif item.product_type == "disk" %}Диск{% elif item.product_type == "akb" %}Аккумулятор{% endif %}
            </td>

            <td class="text-end">
              {{ item.price }} ₽
            </td>

            <td class="text-center">
              <form method="post"
                    action="{% url 'basket:change_quantity' item.id %}"
                    class="d-inline-flex align-items-center justify-content-center">
                {% csrf_token %}
                {# ОЧЕНЬ УЗКОЕ ОКНО КОЛ-ВА #}
                <input type="number"
                       name="quantity"
                       value="{{ item.quantity }}"
                       min="1"
                       class="form-control form-control-sm text-center"
                       style="width: 70px; padding-right: 4px; padding-left: 4px;">
                <button type="submit" class="btn btn-sm btn-outline-primary ms-2">
                  OK
                </button>
              </form>
            </td>

            <td class="text-end">
              {{ item.total_price }} ₽
            </td>

            <td class="text-center">
              <form method="post" action="{% url 'basket:remove_from_cart' item.id %}">
                {% csrf_token %}
                <button type="submit" class="btn btn-sm btn-outline-danger">
                  &times;
                </button>
              </form>
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>

    <div class="d-flex justify-content-end align-items-center mt-4">
      <div class="me-4 fs-5">
        <strong>Итого:</strong> {{ total_price }} ₽
      </div>

      <form method="post" action="{% url 'basket:checkout' %}">
        {% csrf_token %}
        <button type="submit" class="btn btn-success btn-lg">
          Оформить заказ
        </button>
      </form>
    </div>

  {% else %}
    <p>Ваша корзина пуста.</p>
  {% endif %}
</div>
{% endblock %}
